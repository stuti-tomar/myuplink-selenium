pipeline {
    agent any
     parameters {
        booleanParam(name: 'FORCE_RUN', defaultValue: false, description: 'Force pipeline to run even without changes')
    }
    triggers {
        pollSCM('H/5 * * * *')  // Check for changes every 5 minutes
        cron('H 12 * * *')      // Run the job every day at 12 PM (noon)
    }
    stages {
		 // Step 1: Checkout Code from Repository
        stage('Checkout Code') {
            steps {
				echo "Fetching the latest code from the repository..."
                git branch: 'development',
                    url: 'https://github.com/stuti-tomar/myuplink-selenium.git',
                    credentialsId: 'GitHub_PAT'
            }
        }
        
        // Step 2: Run Automated Tests
        stage('Run Tests') {
            steps {
				echo "Running automated tests..."
                bat 'mvn test'
            }
        }
        
        // Step 3: Generate and Archive Test Reports
        
    
       // stage('Generate and Archive Reports') {
         //   steps {
          //     echo "Archiving TestNG reports..."
                // Archive/Store the TestNG XML report
            //    archiveArtifacts artifacts: 'test-output/testng-results.xml', allowEmptyArchive: true
                
                // Publish the TestNG results in Jenkins UI
              // junit '**/test-output/testng-results.xml'
            /*}
        }
    }*/
    
    post {
        always {
			// Notify on Build Completion (Always)
            mail to: 'stuti.tomar2011@gmail.com, stuti.tomar2015@gmail.com',
                subject: "Build #${BUILD_NUMBER}: Test Execution Completed",
                body: "The test execution for build #${BUILD_NUMBER} has completed. Please check Jenkins for details: ${BUILD_URL}"
        }
         success {
            // Notify on Success
            mail to: 'stuti.tomar2011@gmail.com',
                subject: "Build #${BUILD_NUMBER}: SUCCESS",
                body: "All tests passed successfully for build #${BUILD_NUMBER}. Details: ${BUILD_URL}"
        }
        failure {
            // Notify on Failure
            mail to: 'stuti.tomar2015@gmail.com',
                subject: "Build #${BUILD_NUMBER}: FAILURE",
                body: "Some tests failed in build #${BUILD_NUMBER}. Please investigate the issues. Logs: ${BUILD_URL}"
        }
    }
}